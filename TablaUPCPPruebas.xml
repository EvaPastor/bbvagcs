<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Tabla Pruebas de Upgrade"
	description="Tabla que visualiza los datos de upgrade producto del Cliente"
	author_affiliation="Capgemini" height="100">
	<Require feature="idi"/>
	<Require feature="locked-domain" />
	<Require feature="dynamic-height" />
</ModulePrefs>
  
<UserPref name="_table_query_url" default_value="" display_name="Data source url" required="true" />

<Content type="html"><![CDATA[
    
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

      <style type="text/css">
      .cabeceraTabla{
      	font-size: .8em;
        background: #1D44AF;
        color: white;
        padding-top: 5px;
        padding-bottom: 5px;
        text-align: center;
      }
      .datosTablaCentro{
      	font-size: .8em;
        text-align: center;
      }
      .datosTablaIzquierda{
      	font-size: .8em;
        padding-top: 5px;
        padding-bottom: 5px;

      }
      .marginTabla{
        margin-left: 0px;
      }
      .nombreCampo{
      	font-size: .8em;
        color: blue;
        width: 165px;
        vertical-align: text-top;
      }
      .valorCampo{
      	font-size: .8em;
        vertical-align: text-top;
      }
      .requerimiento{
        width: 100px;
      }
      .descripcion{
        width: 340px;
      }
      .estado{
        width: 70px;
      }
      .redmine{
        width: 70px;
      }
      .analisis{
        width: 70px;
      }
      .diseno{
        width: 70px;
      }
      .construccion{
        width: 70px;
      }
      .pruebasFuncionales{
        width: 70px;
      } 
      .pruebasAceptacion{
        width: 70px;
      }   
      .implantacion{
        width: 70px;
      }     
  </style>
  
<script type="text/javascript"> 

	var prefs = new _IG_Prefs(); // User preferences
    //var URL='https://spreadsheets.google.com/feeds/list/12NJIxlRlLtj7rMsmJy1_aySqKFJjTOtsWDE2IMkYay4/od6/public/values?alt=json';
	var URL=prefs.getString("_table_query_url");
    function Get(URL){
      var Httpreq = new XMLHttpRequest(); // a new request
      Httpreq.open("GET",URL,false);
      Httpreq.send(null);
      return Httpreq.responseText;          
    }
    var json_obj = JSON.parse(Get(URL));

    var filas = json_obj.feed.entry.length;
    var cuerpo="";


    function creacionConsulta(){
      //Construcción de la cabecera
      cuerpo +="<table class='marginTabla'>"+
                  "<tr>"+
                    "<td class='nombreCampo'>Descripción:</td>"+
                    "<td class='valorCampo'>"+ json_obj.feed.entry[0].gsx$datos.$t +"</td>"+
                  "</tr>"+
                  "<tr>"+
                    "<td class='nombreCampo'>Código PPM Iniciativa:</td>"+
                    "<td class='valorCampo'>"+ json_obj.feed.entry[1].gsx$datos.$t +"</td>"+
                  "</tr>"+
                  "<tr>"+
                    "<td class='nombreCampo'>Código PPM Proyecto:</td>"+
                    "<td class='valorCampo'>"+ json_obj.feed.entry[2].gsx$datos.$t +"</td>"+
                  "</tr>"+
                  "<tr>"+
                    "<td class='nombreCampo'>Fecha Implantación:</td>"+
                    "<td class='valorCampo'>"+ json_obj.feed.entry[3].gsx$datos.$t +"</td>"+
                  "</tr>"+
                  "<tr>"+
                    "<td class='nombreCampo'>Requerimientos:</td>"+
                    "<td class='valorCampo'>"+ json_obj.feed.entry[4].gsx$datos.$t +"</td>"+
                  "</tr>"+
                "</table>"+
                "<br>";
      //Construccion de la tabla de los requerimientos
      cuerpo +="<table class='marginTabla'>"+
                  "<tr>"+
                    "<td class='requerimiento cabeceraTabla'>Requerimiento</td>"+
                    "<td class='descripcion cabeceraTabla'>Descripción</td>"+
                    "<td class='estado cabeceraTabla'>Estado</td>"+
                    "<td class='redmine cabeceraTabla'>C. Redmine</td>"+
                    "<td class='analisis cabeceraTabla'>Análisis</td>"+
                    "<td class='diseno cabeceraTabla'>Diseño</td>"+
                    "<td class='construccion cabeceraTabla'>Construcción</td>"+
                    "<td class='pruebasFuncionales cabeceraTabla'>Pruebas Funcionales</td>"+
                    "<td class='pruebasAceptacion cabeceraTabla'>Pruebas Aceptación</td>"+
                    "<td class='implantacion cabeceraTabla'>Implantación</td>"+
                  "</tr>";
                for(var i = 6; i < filas; i++) {                   
                  cuerpo += "<tr>"+
                    "<td class='requerimiento datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$requerimiento.$t +"</td>"+
                    "<td class='descripcion datosTablaIzquierda'>"+ json_obj.feed.entry[i].gsx$descripcion.$t +"</td>"+
                    "<td class='estado datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$estado.$t +"</td>"+
                    "<td class='redmine datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$redmine.$t +"</td>"+
                    "<td class='analisis datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$analisis.$t +"</td>"+
                    "<td class='diseno datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$disenio.$t +"</td>"+
                    "<td class='construccion datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$construccion.$t +"</td>"+
                    "<td class='pruebasFuncionales datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$pruebasfunc.$t +"</td>"+
                    "<td class='pruebasAceptacion datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$pruebasacep.$t +"</td>"+
                    "<td class='implantacion datosTablaCentro'>"+ json_obj.feed.entry[i].gsx$implantacion.$t +"</td>"+
                  "</tr>";
                }
      cuerpo +="</table>";
      document.write(cuerpo);
    }
  </script>
      
    <div id="content">
      <script type="text/javascript"> 
        creacionConsulta();
        gadgets.window.adjustHeight();
      </script>
    </div> 
]]>
</Content>
</Module>